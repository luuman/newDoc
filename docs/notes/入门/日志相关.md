# 日志规范

## 使用

```js
// infoLog.js
const { log4js } = require("./index");
const name = "info-dev";
module.exports = log4js.getLogger(name);
```

```js
// 使用infoLog
const infoLog = require("./logs/infoLog.js");
infoLog.info(val);
```

### 级别分类

| 级别  | 权重             | 描述 |
| ----- | ---------------- | ---- |
| ALL   | Number.MIN_VALUE |      |
| TRACE | 5000             |      |
| DEBUG | 10000            |      |
| INFO  | 20000            |      |
| WARN  | 30000            |      |
| ERROR | 40000            |      |
| FATAL | 50000            |      |
| MARK  | 9007199254740992 |      |
| OFF   | Number.MAX_VALUE |      |

## 日志分类

日志类别（用户行为偏运营/用户信息/性能数据/异常数据）
分进程、分组件、分类别、分事件、按用户、脱敏
2019-12-01 00:00:00.000|pid|log-level|[svc-name,trace-id,span-id,user-id,biz-id]|thread-name|package-name.class-name : log message
[2019-12-01 00:00:00.000 IPC-Main Login ][]

| 类别名称              | 位置                   | 行为 | 描述         |
| --------------------- | ---------------------- | ---- | ------------ |
| avr-risk              | logs                   |      |              |
| live-dev              | logs                   |      | 直播         |
| cst-sdk               | logs                   |      |              |
| cst-meeting-sdk       | logs                   |      | 会议 SDK     |
| cst-meeting-agent     | logs/CST_Meeting/agent |      | 会议代理     |
| callfeedbackLog       | logs                   |      | 通话反馈     |
| deleteAccountFeedback | logs                   |      | 删除账号反馈 |
| delete-account        | logs                   |      | 删除账号     |
| file-dev              | logs                   |      | 文件         |
| pictureViewer         | logs                   |      | 图片查看     |
| fileViewer            | logs                   |      | 文件查看     |
| screenshot            | logs                   |      | 截图         |
| info-dev              | logs                   |      | 接口         |
| setEmoji              | logs                   |      |              |
| msgAllLog             | logs                   |      |              |
| session-dev           | logs                   |      |              |
| msgback-dev           | logs                   |      |              |
| lost-msg-dev          | logs                   |      |              |
| [pkg.name]-usage      | logs                   |      |              |

## 日志实例 [index.js]

```js
// index.js
const pkg = require("../../package.json");
const log4js = require("./lib/log4js");
const { handleConfig, initLogConfig } = require("./log.config.js");
const { debug } = require("../../config");
const password = debug ? "" : "empty";
const name = pkg.name;
const configDir =
  global.userDatapath || require("@/config/config.js").configDir;
const categoryNames = [
  { categoryName: "appLog" },
  { categoryName: "bridgeLog" },
  { categoryName: "ipcMainLog" },
  { categoryName: "sdkLog" },
  { categoryName: "e2eeLog" },
  { categoryName: "meetingLog" },
  { categoryName: "liveLog" },
  { categoryName: "updaterLog" },
  { categoryName: "renderLog" },
  { categoryName: "callfeedbackLogMain", appenderName: "callfeedbackLog" },
  { categoryName: "fileViewerMainLog", appenderName: "fileViewer" },
  { categoryName: "screenshotLogMain", appenderName: "screenshot" },
  { categoryName: "fileLog" },
  { categoryName: "messageLog" },
  { categoryName: "apiLog" }
];
const appenderNames = [
  { appenderName: "avr-risk" },
  { appenderName: "callfeedbackLog" },
  { appenderName: "deleteAccountFeedback" },
  { appenderName: "delete-account" },
  { appenderName: "file-dev" },
  { appenderName: "lost-msg-dev" },
  { appenderName: "fileViewer" },
  { appenderName: "info-dev" },
  { appenderName: "live-dev" },
  { appenderName: "msgAllLog" },
  { appenderName: "cst-meeting-sdk" },
  { appenderName: "cst-meeting-agent", filename: "CST_Meeting/agent" },
  { appenderName: "msgback-dev" },
  { appenderName: "pictureViewer" },
  { appenderName: "screenshot" },
  { appenderName: "cst-sdk" },
  { appenderName: "session-dev" },
  { appenderName: "setEmoji" },
  { appenderName: pkg.name + "-usage" }
];
const config = initLogConfig(configDir, name, "5M", password);
handleConfig(config, { appenderNames, categoryNames }, configDir);
log4js.configure(config);
const log = log4js.getLogger();
const object = {
  log4js,
  default: log
};
for (let index = 0; index < categoryNames.length; index++) {
  const item = categoryNames[index];
  if (item.categoryName) {
    object[item.categoryName] = log4js.getLogger(item.categoryName);
  }
}
log.info("loginit on:", new Date().toString());
module.exports = object;
```
